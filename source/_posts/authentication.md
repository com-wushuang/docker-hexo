---
title: 认证
date: 2020-12-25 16:17:23
tags:
---

## 认证

### 定义

身份验证的目的是确认当前所声称为某种身份的用户，确实是所声称的用户。简单来说就是系统确认你是你的过程，用户声称自己是管理员，用什么证明？当你输入了正确的管理员账户和密码，你是管理员就被证实了，这就是认证的通俗解释。

### 方式

- 用户名密码
- cookie
- token

## 用户名密码认证

客户端发送请求时，携带用户名和密码，服务器根据用户名和密码对请求进行认证。

- 优点：简单
- 缺点：
  - 用户名密码泄漏风险大
  - 每次请求到达，服务器都需要比对用户密码数据库，服务器端压力大
  - 无法提供更多的有效信息，只有用户名

## 基于cookie的认证

用户在登录后，服务器端需要跟踪记录session 并保存，保存方式多种多样，可以是内存，数据库，缓存中，并通过 set-cookie 将生成的sessionID 写入的客户端的 cookie 中，作为 session 的唯一标识符，也可以直接加密保存到 Cookie中，实现一种无状态 session。在需要认证的接口的时候，客户端的请求体会携带 Cookie 发送给服务端。服务器读取 Cookie 中的 session 信息获取认证信息。

![session]()

## 什么是token？

Token是服务端生成的一串字符串，用作客户端进行请求的一个令牌，当第一次登录后，服务器生成一个Token返回给客户端，以后客户端只需带上这个Token前来请求数据即可，无需再次带上用户名和密码。

简单token的组成；uid(用户唯一的身份标识)、time(当前时间的时间戳)、sign(数字签名，服务器的签名，表示该token由服务器签发)

## 为什么需要token

- HTTP是无状态协议，客户端使用用户名和密码通过了身份验证，不过下次这个客户端再发送请求时候，还得再验证一下。也就是说如果没有token，那么客户端的每次请求都需要携带用户和密码信息，同时服务器每次都需要对用户和密码进行验证。对服务器来说每次验证都是查询数据库，服务器压力很大。
- 如果客户端每次请求都携带用户名和密码，用户密码泄漏的风险会变高；同时，相比较密码，token具有时效性，就算泄漏了，那也会因为过期而失效，如果是密码泄漏，如果用户不主动修改密码，那么账户的风险会一直存在。

## token的存储

- 客户端存储在cookie中
- 服务器端存储方式有很多实现，数据库，内存。

## 基于token的身份认证

使用token机制的身份验证方法，大概的流程：

1. 客户端使用用户名和密码请求登录。
2. 服务端收到请求，验证用户名和密码。
3. 验证成功后，服务端会生成一个token，然后把这个token发送给客户端。
4. 客户端收到token后把它存储起来，可以放在cookie或者Local Storage（本地存储）里。
5. 客户端每次向服务端发送请求的时候都需要带上服务端发给的token。
6. 服务端收到请求，然后去验证客户端请求里面带着token，如果验证成功，就向客户端返回请求的数据。

